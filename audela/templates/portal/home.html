{% extends "portal/layout.html" %}

{% set title = "Home" %}

{% block portal_content %}
  <div class="box">
    <h3>{{ _("O que já está no MVP") }}</h3>
    <ul>
      <li><strong>{{ _("Fontes por tenant") }}</strong> ({{ _("cadastro + introspecção") }})</li>
      <li><strong>{{ _("Editor SQL") }}</strong> ({{ _("execução ad-hoc com limites") }})</li>
      <li><strong>{{ _("Perguntas") }}</strong> ({{ _("queries salvas") }}) + {{ _("execução") }}</li>
      <li><strong>{{ _("Dashboards") }}</strong> ({{ _("cards simples com perguntas") }})</li>
      <li><strong>{{ _("Auditoria") }}</strong> + <strong>{{ _("Query Runs") }}</strong> {{ _("por tenant") }}</li>
    </ul>
  </div>

  <div class="box">
    <h3>{{ _("Começar") }}</h3>
    <ol>
      <li>{{ _("Crie uma fonte em Fontes → Nova") }} <a href="{{ url_for('portal.sources_new') }}">{{ _("Fontes") }} → {{ _("Nova") }}</a></li>
      <li>{{ _("Introspecte metadados na fonte (botão 'Introspectar')") }}</li>
      <li>{{ _("Teste uma consulta no Editor SQL") }} <a href="{{ url_for('portal.sql_editor') }}">{{ _("Editor SQL") }}</a></li>
      <li>{{ _("Salve uma Pergunta e crie um Dashboard") }} <a href="{{ url_for('portal.questions_new') }}">{{ _("Pergunta") }}</a> {{ _("e crie um") }} <a href="{{ url_for('portal.dashboards_new') }}">{{ _("Dashboard") }}</a></li>
    </ol>
  </div>
  
  <div class="box mt-3">
    <h3>Dashboards</h3>
    {% if main_dashboard %}
      <div class="mb-2">
        <strong>Principal:</strong> <a href="{{ url_for('portal.dashboard_view', dashboard_id=main_dashboard.id) }}">{{ main_dashboard.name }}</a>
      </div>
    {% endif %}
    {% if dashboards %}
      <ul>
        {% for d in dashboards %}
          <li>
            <a href="{{ url_for('portal.dashboard_view', dashboard_id=d.id) }}">{{ d.name }}</a>
            {% if current_user.has_role('tenant_admin') %}
              <form method="post" action="{{ url_for('portal.dashboards_set_primary', dashboard_id=d.id) }}" style="display:inline; margin-left:.5rem;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                <button class="btn btn-sm btn-outline-secondary">Definir como principal</button>
              </form>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>Nenhum dashboard criado ainda.</p>
    {% endif %}
  </div>
{% endblock %}
