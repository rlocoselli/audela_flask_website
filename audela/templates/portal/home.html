{% extends "portal/layout.html" %}

{% set title = "Home" %}

{% block portal_content %}
  <div class="box">
    <h3>O que já está no MVP</h3>
    <ul>
      <li><strong>Fontes por tenant</strong> (cadastro + introspecção)</li>
      <li><strong>Editor SQL</strong> (execução ad-hoc com limites)</li>
      <li><strong>Perguntas</strong> (queries salvas) + execução</li>
      <li><strong>Dashboards</strong> (cards simples com perguntas)</li>
      <li><strong>Auditoria</strong> + <strong>Query Runs</strong> por tenant</li>
    </ul>
  </div>

  <div class="box">
    <h3>Começar</h3>
    <ol>
      <li>Crie uma fonte em <a href="{{ url_for('portal.sources_new') }}">Fontes → Nova</a></li>
      <li>Introspecte metadados na fonte (botão “Introspectar”)</li>
      <li>Teste uma consulta no <a href="{{ url_for('portal.sql_editor') }}">Editor SQL</a></li>
      <li>Salve uma <a href="{{ url_for('portal.questions_new') }}">Pergunta</a> e crie um <a href="{{ url_for('portal.dashboards_new') }}">Dashboard</a></li>
    </ol>
  </div>
  
  <div class="box mt-3">
    <h3>Dashboards</h3>
    {% if main_dashboard %}
      <div class="mb-2">
        <strong>Principal:</strong> <a href="{{ url_for('portal.dashboard_view', dashboard_id=main_dashboard.id) }}">{{ main_dashboard.name }}</a>
      </div>
    {% endif %}
    {% if dashboards %}
      <ul>
        {% for d in dashboards %}
          <li>
            <a href="{{ url_for('portal.dashboard_view', dashboard_id=d.id) }}">{{ d.name }}</a>
            {% if current_user.has_role('tenant_admin') %}
              <form method="post" action="{{ url_for('portal.dashboards_set_primary', dashboard_id=d.id) }}" style="display:inline; margin-left:.5rem;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                <button class="btn btn-sm btn-outline-secondary">Definir como principal</button>
              </form>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>Nenhum dashboard criado ainda.</p>
    {% endif %}
  </div>
{% endblock %}
