{% extends "portal/layout.html" %}
{% set title = "Nova pergunta" %}

{% block portal_content %}
<div class="container-fluid px-0">

  <!-- HEADER -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h4 class="mb-1">âž• Nova pergunta</h4>
      <p class="text-muted mb-0">
        Defina uma pergunta reutilizÃ¡vel baseada em uma consulta SQL.
      </p>
    </div>
  </div>

  <!-- FORM CARD -->
  <div class="card shadow-sm">
    <div class="card-body">

      <form method="post">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <!-- Nome -->
        <div class="mb-3">
          <label class="form-label">Nome</label>
          <input
            type="text"
            name="name"
            class="form-control"
            placeholder="Ex.: Total de vendas por mÃªs"
            required
          >
          <div class="form-text">
            Nome exibido para usuÃ¡rios e dashboards.
          </div>
        </div>

        <!-- Fonte -->
        <div class="mb-3">
          <label class="form-label">Fonte de dados</label>
          <select name="source_id" class="form-select" required>
            <option value="">â€” selecione â€”</option>
            {% for s in sources %}
              <option value="{{ s.id }}">
                {{ s.name }} ({{ s.type }})
              </option>
            {% endfor %}
          </select>
          <div class="form-text">
            A pergunta ficarÃ¡ vinculada a esta fonte.
          </div>
        </div>

        <!-- SQL -->
        <div class="mb-4">
          <label class="form-label">SQL</label>
          <textarea
            name="sql_text"
            class="form-control"
            rows="10"
            placeholder="SELECT ..."
            required
          ></textarea>
          <div class="form-text">
            Somente leitura.
            Se a fonte exigir tenant, inclua <code>:tenant_id</code>.
          </div>
        </div>

        <!-- ACTIONS -->
        <div class="d-flex justify-content-end gap-2">
          <a
            href="{{ url_for('portal.questions_list') }}"
            class="btn btn-outline-secondary"
          >
            Cancelar
          </a>
          <button type="submit" class="btn btn-primary">
            ðŸ’¾ Salvar pergunta
          </button>
        </div>

      </form>

    </div>
  </div>

</div>
{% endblock %}
