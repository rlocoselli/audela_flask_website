{% extends "portal/layout.html" %}
{% set title = "Fontes" %}

{% block portal_content %}
<div class="container-fluid px-0">

  <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
    <div>
      <h1 class="h4 mb-0">Fontes</h1>
      <div class="text-muted small">Conexões de banco de dados e workspaces.</div>
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-primary btn-sm" href="{{ url_for('portal.sources_new') }}"><i class="bi bi-plus-lg"></i> Nova fonte</a>
      <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('portal.workspaces_new') }}">Novo workspace</a>
      <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('portal.workspaces_list') }}">Workspaces</a>
    </div>
  </div>

  <div class="card shadow-sm border-0 rounded-4">
    <div class="card-body">
      {% if not sources %}
        <div class="text-muted">Nenhuma fonte cadastrada ainda.</div>
      {% else %}
        <div class="table-responsive">
          <table class="table table-sm align-middle mb-0">
            <thead>
              <tr>
                <th>Nome</th>
                <th>Tipo</th>
                <th>Criada em</th>
                <th class="text-end">Ações</th>
              </tr>
            </thead>
            <tbody>
              {% for s in sources %}
                <tr>
                  <td>
                    <a href="{{ url_for('portal.sources_view', source_id=s.id) }}" class="text-decoration-none fw-semibold">{{ s.name }}</a>
                  </td>
                  <td><span class="badge text-bg-light border">{{ s.type }}</span></td>
                  <td class="text-muted small">{{ s.created_at }}</td>
                  <td class="text-end">
                    <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('portal.sources_edit', source_id=s.id) }}"><i class="bi bi-pencil"></i></a>
                    <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('portal.sources_introspect', source_id=s.id) }}">Introspectar</a>
                    <form method="post" action="{{ url_for('portal.sources_delete', source_id=s.id) }}" class="d-inline" onsubmit="return confirm('Remover fonte?');">
                      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                      <button type="submit" class="btn btn-outline-danger btn-sm"><i class="bi bi-trash"></i></button>
                    </form>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% endif %}
    </div>
  </div>

</div>
{% endblock %}
