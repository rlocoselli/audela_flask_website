{% extends "finance/base_finance.html" %}

{% block finance_content %}
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h4 class="mb-0">{{ _('E-faturas') }}</h4>
      <div class="text-secondary small">{{ _('PDF + XML (Factur-X FR / FatturaPA IT)') }}</div>
    </div>
    {% if current_user and current_user.is_authenticated %}
      <div class="d-flex gap-2">
        <a class="btn btn-outline-secondary" href="{{ url_for('finance.pivot_page') }}">{{ _('Pivot') }}</a>
        <a class="btn btn-primary" href="{{ url_for('finance.invoice_new') }}">{{ _('Nova fatura') }}</a>
      </div>
    {% endif %}
  </div>

  <div class="card shadow-sm">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead>
            <tr>
              <th>{{ _('Número') }}</th>
              <th>{{ _('Tipo') }}</th>
              <th>{{ _('Status') }}</th>
              <th>{{ _('Data') }}</th>
              <th>{{ _('Vencimento') }}</th>
              <th>{{ _('Contraparte') }}</th>
              <th class="text-end">{{ _('Total') }}</th>
              <th class="text-end">{{ _('Ações') }}</th>
            </tr>
          </thead>
          <tbody>
            {% for inv in invoices %}
              <tr>
                <td>
                  <a href="{{ url_for('finance.invoice_view', invoice_id=inv.id) }}" class="text-decoration-none">
                    {{ inv.invoice_number }}
                  </a>
                </td>
                <td>
                  {% if inv.invoice_type=='purchase' %}
                    <span class="badge bg-secondary">{{ _('Compra') }}</span>
                  {% else %}
                    <span class="badge bg-primary">{{ _('Venda') }}</span>
                  {% endif %}
                </td>
                <td>
                  <span class="badge {% if inv.status=='paid' %}bg-success{% elif inv.status=='sent' %}bg-info{% elif inv.status=='void' %}bg-dark{% else %}bg-warning text-dark{% endif %}">
                    {{ inv.status }}
                  </span>
                </td>
                <td>{{ inv.issue_date }}</td>
                <td>{{ inv.due_date or '' }}</td>
                <td>{{ inv.counterparty.name if inv.counterparty else '' }}</td>
                <td class="text-end">{{ '%.2f'|format(inv.total_gross or 0) }} {{ inv.currency }}</td>
                <td class="text-end">
                  <div class="finance-row-actions justify-content-end">
                    <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('finance.invoice_edit', invoice_id=inv.id) }}">{{ _('Editar') }}</a>
                    <a class="btn btn-outline-primary btn-sm" href="{{ url_for('finance.invoice_export', invoice_id=inv.id, country='fr') }}">{{ _('FR ZIP') }}</a>
                    <a class="btn btn-outline-primary btn-sm" href="{{ url_for('finance.invoice_export', invoice_id=inv.id, country='it') }}">{{ _('IT ZIP') }}</a>
                  </div>
                </td>
              </tr>
            {% else %}
              <tr>
                <td colspan="8" class="text-center text-secondary py-4">{{ _('Nenhuma fatura ainda.') }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
{% endblock %}

{% block head_extra %}
  {{ super() }}
  <style>
    .finance-row-actions {
      display: inline-flex;
      flex-wrap: wrap;
      gap: .35rem;
    }

    @media (max-width: 767.98px) {
      .finance-row-actions {
        display: flex;
        justify-content: stretch !important;
      }

      .finance-row-actions .btn {
        width: 100%;
      }
    }
  </style>
{% endblock %}
