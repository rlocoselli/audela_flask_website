{% extends "base.html" %}

{% block title %}AUDELA – Plans{% endblock %}

{% block content %}
<section id="main" class="wrapper style1">
  <div class="container">
    <header class="major">
      <h2>{{ _('Plans d’abonnement') }}</h2>
      <p>{{ _('Cette page reflète exactement les offres disponibles à l’abonnement.') }}</p>
    </header>

    {% if selected_product == 'finance' %}
      <div class="box" style="margin-bottom:1rem;">
        <strong>{{ _('Filtre actif : Finance') }}</strong>
      </div>
    {% elif selected_product == 'bi' %}
      <div class="box" style="margin-bottom:1rem;">
        <strong>{{ _('Filtre actif : BI') }}</strong>
      </div>
    {% elif selected_product == 'project' %}
      <div class="box" style="margin-bottom:1rem;">
        <strong>{{ _('Filtre actif : Projet') }}</strong>
      </div>
    {% endif %}

    {% if plans %}
      <div class="row gtr-150">
        {% for plan in plans %}
          <div class="col-4 col-12-medium">
            <section class="box">
              <h3>{{ plan.name }}</h3>
              {% if plan.description %}
                <p>{{ plan.description }}</p>
              {% endif %}

              <p><strong>{{ '%.2f'|format(plan.price_monthly or 0) }} {{ plan.currency or 'EUR' }} / {{ _('mois') }}</strong></p>

              <ul class="alt">
                <li>{{ _('Utilisateurs') }}: {{ '∞' if plan.max_users == -1 else plan.max_users }}</li>
                <li>{{ _('Entreprises') }}: {{ '∞' if plan.max_companies == -1 else plan.max_companies }}</li>
                <li>{{ _('Transactions/mois') }}: {{ '∞' if plan.max_transactions_per_month == -1 else plan.max_transactions_per_month }}</li>
                <li>{{ _('Support premium') }}: {{ _('Oui') if (plan.features_json and plan.features_json.get('premium_support')) else _('Non') }}</li>
                <li>{{ _('Essai') }}: {{ plan.trial_days }} {{ _('jours') }}</li>
              </ul>

              {% if current_user.is_authenticated %}
                {% if current_plan and current_plan.code == plan.code %}
                  <a href="{{ url_for('billing.subscription') }}" class="button">{{ _('Gérer mon abonnement') }}</a>
                {% else %}
                  <a href="{{ url_for('billing.upgrade', plan_code=plan.code) }}" class="button primary">{{ _('Choisir ce plan') }}</a>
                {% endif %}
              {% else %}
                <a href="{{ url_for('tenant.login') }}" class="button primary">{{ _('Se connecter pour continuer') }}</a>
              {% endif %}
            </section>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <section class="box">
        <p class="mb-0">{{ _('Aucun plan disponible pour le moment.') }}</p>
      </section>
    {% endif %}
  </div>
</section>
{% endblock %}
